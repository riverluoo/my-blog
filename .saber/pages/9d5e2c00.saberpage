{"page":{"attributes":{"slug":"middle/nginx","title":"nginx","date":"2019-04-03","layout":"post","excerpt":"<p>先匹配普通 再匹配正则</p>\n","createdAt":"2019-04-03T00:00:00.000Z","updatedAt":"2019-05-07T07:25:41.183Z","type":"post","permalink":"/posts/middle/nginx.html"},"internal":{"id":"9d5e2c00","absolute":"/root/src/my-blog/pages/_posts/middle/nginx.md","relative":"_posts/middle/nginx.md","isFile":true,"hoistedTags":[],"saved":false},"contentType":"markdown","content":"<h1 id=\"%E4%B8%80-location-%E7%9A%84%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99\">一 location 的匹配规则</h1>\n<p>先匹配普通 再匹配正则</p>\n<ul>\n<li><a href=\"https://www.cnblogs.com/lidabo/p/4169396.html\" target=\"_blank\" rel=\"noopener noreferrer\">参考文档</a></li>\n</ul>\n<div class=\"saber-highlight\" v-pre=\"\" data-lang=\"\"><pre class=\"saber-highlight-code\"><code class=\"\"># a\nlocation /manage/ {\n            proxy_pass http://127.0.0.1:8001;\n            proxy_redirect             off;\n        }\n\n# b\nlocation ~/manage/(log|organizationy)\\b {\n            proxy_pass http://127.0.0.1:8002;\n            proxy_redirect  off;\n        }</code></pre></div><h2 id=\"location-%E7%9A%84%E6%89%A7%E8%A1%8C%E9%80%BB%E8%BE%91%E5%92%8C%E7%BC%96%E8%BE%91%E9%A1%BA%E5%BA%8F%E7%9A%84%E5%85%B3%E7%B3%BB\">location 的执行逻辑和编辑顺序的关系</h2>\n<p>普 location 和编辑顺序无关 正则 location 和编辑顺序有关\n正则 location 匹配让步普通 location 的严格精确匹配结果；但覆盖普通 location 的最大前缀匹配结果</p>\n<h2 id=\"%E5%88%86%E7%B1%BB\">分类</h2>\n<ul>\n<li>正则\n“~ ”和“~_ ”前缀表示正则 location ，“~ ”区分大小写，“~_ ”不区分大小写</li>\n<li>普通\n“=”，“^~ ”和“@ ”和无任何前缀的都属于普通 location</li>\n</ul>\n<h2 id=\"%E2%80%9C%40%E2%80%9D-%E5%89%8D%E7%BC%80\">“@” 前缀</h2>\n<p>这种“Named Location ”不是用来处理普通的 HTTP 请求的，用来处理“内部重定向（internally redirected ）”请求的</p>\n<h1 id=\"%E4%BA%8C-%E8%BD%AC%E5%8F%91-tcp-%E8%AF%B7%E6%B1%82\">二 转发 tcp 请求</h1>\n<p>业务场景需要 nginx 转发自定义的 tcp 请求到内网的 ip 和端口</p>\n<ul>\n<li><a href=\"http://nginx.org/en/docs/stream/ngx_stream_core_module.html#stream\" target=\"_blank\" rel=\"noopener noreferrer\">官方文档</a>\n从 1.9 版本开始 nginx 对转发 tcp 和 udp 进行了支持</li>\n</ul>\n<div class=\"saber-highlight\" v-pre=\"\" data-lang=\"\"><pre class=\"saber-highlight-code\"><code class=\"\">stream {\n    upstream ia{\n        server 00.00.00.00:20000 max_fails = 3 fail_timeout = 30s;\n    }\n    server {\n        proxy_connect_timeout 1s;\n        proxy_timeout 3s;\n        listen 18091;\n        proxy_pass ia;\n    }\n\n}</code></pre></div><h2 id=\"%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98\">遇到的问题</h2>\n<ul>\n<li><a href=\"https://www.jianshu.com/p/244386221cc5\" target=\"_blank\" rel=\"noopener noreferrer\">使用 Nginx 转发 TCP/UDP</a></li>\n<li><a href=\"https://blog.csdn.net/testcs_dn/article/details/51461750\" target=\"_blank\" rel=\"noopener noreferrer\">./configure: error: C compiler cc is not found</a></li>\n<li><a href=\"https://blog.csdn.net/cailongbiaoyuli/article/details/84348866\" target=\"_blank\" rel=\"noopener noreferrer\">No rule to make target build, needed by default. Stop.</a></li>\n<li><a href=\"https://blog.csdn.net/ytangdigl/article/details/79796961\" target=\"_blank\" rel=\"noopener noreferrer\">关闭防火墙</a></li>\n<li><a href=\"https://www.cnblogs.com/juanjuankaikai/p/9598976.html\" target=\"_blank\" rel=\"noopener noreferrer\">替换安装方式</a></li>\n<li><a href=\"http://www.sohu.com/a/59138683_354963\" target=\"_blank\" rel=\"noopener noreferrer\">动态模块</a></li>\n</ul>\n"},"prop":{}}